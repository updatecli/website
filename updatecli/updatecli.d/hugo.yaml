title: Bump Hugo version

scms:
  default:
    kind: "github"
    spec:
      user: "updatecli"
      email: "updatecli@olblak.com"
      owner: "updatecli"
      repository: "website"
      token: '{{ requiredEnv "UPDATECLI_GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "UPDATECLI_GITHUB_ACTOR" }}'
      branch: "master"

sources:
  hugo:
    name: "Get latest HUGO version"
    kind: "githubrelease"
    spec:
      owner: "gohugoio"
      repository: "hugo"
      token: '{{ requiredEnv "UPDATECLI_GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "UPDATECLI_GITHUB_ACTOR" }}'
    transformers:
      - trimPrefix: "v"

targets:
  netlify:
    name: Update Hugo version used on Netlify
    kind: file
    scmid: "default"
    spec:
      file: "netlify.toml"
      matchpattern: 'HUGO_VERSION = "(.*)"'
      replacepattern: 'HUGO_VERSION = "{{ source "hugo" }}"'

  githubaction:
    name: Update Hugo version used in Github Action
    kind: file
    scmid: "default"
    sourceid: hugo
    spec:
      file: ".github/workflows/build.yaml"
      matchpattern: 'hugo-version: (.*)'
      replacepattern: 'hugo-version: {{ source "hugo" }}'

pullrequests:
  default:
    title: '[updatecli] Bump HUGO to {{ source "hugo" }}'
    kind: "github"
    scmid: "default"
    targets:
      - "netlify"
      - "githubaction"
    spec:
      automerge: true
      mergemethod: "squash"
      labels:
        - "chore"
        - "dependencies"
